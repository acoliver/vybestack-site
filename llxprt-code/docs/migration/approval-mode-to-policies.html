<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Migrating from Approval Mode to Policies | LLxprt Code Docs</title>
  <link rel="stylesheet" href="../../../vybestack.css" />
</head>
<body>

  <nav>
    <div class="nav-container">
      <div class="nav-left">
        <a href="/" class="logo">
          <img src="/assets/vybestack_logo.png" alt="Vybestack" />
        </a>
        <span class="tagline">Beyond Vibe Coding</span>
      </div>
      <div class="nav-right">
        <div class="nav-dropdown">
          <a href="/llxprt-code.html">LLxprt Code</a>
          <div class="nav-dropdown-menu">
            <a href="/llxprt-code.html">Overview</a>
            <a href="/llxprt-code/docs/">Documentation</a>
          </div>
        </div>
        <a href="/jefe.html">LLxprt Jefe</a>
        <a href="/blog/">Blog</a>
        <a href="/#podcast">Podcast</a>
        <a href="https://discord.gg/Wc6dZqWWYv" target="_blank">Discord</a>
      </div>
    </div>
  </nav>


  <section class="section docs-section">
    <div class="container-wide">
      <div class="docs-layout">

      <nav class="docs-sidebar">
        <h3><a href="/llxprt-code/docs/">Documentation</a></h3>
        <ul>
          <li><a href="/llxprt-code/docs/getting-started.html">Getting Started Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/providers.html">Provider Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/authentication.html">Authentication</a></li>
          <li><a href="/llxprt-code/docs/cli/profiles.html">Profiles</a></li>
          <li><a href="/llxprt-code/docs/sandbox.html">Sandboxing</a></li>
          <li><a href="/llxprt-code/docs/subagents.html">Subagents</a></li>
          <li><a href="/llxprt-code/docs/oauth-setup.html">OAuth Setup</a></li>
          <li><a href="/llxprt-code/docs/local-models.html">Local Models</a></li>
          <li><a href="/llxprt-code/docs/zed-integration.html">Zed Editor Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/providers-openai-responses.html">OpenAI Responses API</a></li>
          <li><a href="/llxprt-code/docs/prompt-configuration.html">Prompt Configuration</a></li>
          <li><a href="/llxprt-code/docs/settings-and-profiles.html">Settings and Profiles</a></li>
          <li><a href="/llxprt-code/docs/checkpointing.html">Checkpointing</a></li>
          <li><a href="/llxprt-code/docs/extension.html">Extensions</a></li>
          <li><a href="/llxprt-code/docs/ide-integration.html">IDE Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/configuration.html">Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/commands.html">Commands Reference</a></li>
          <li><a href="/llxprt-code/docs/troubleshooting.html">Troubleshooting Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/index.html">CLI Introduction</a></li>
          <li><a href="/llxprt-code/docs/deployment.html">Execution and Deployment</a></li>
          <li><a href="/llxprt-code/docs/keyboard-shortcuts.html">Keyboard Shortcuts</a></li>
          <li><a href="/llxprt-code/docs/cli/themes.html">Themes</a></li>
          <li><a href="/llxprt-code/docs/EMOJI-FILTER.html">Emoji Filter</a></li>
          <li><a href="/llxprt-code/docs/cli/runtime-helpers.html">Runtime helper APIs</a></li>
          <li><a href="/llxprt-code/docs/cli/context-dumping.html">Context Dumping</a></li>
          <li><a href="/llxprt-code/docs/telemetry.html">Telemetry</a></li>
          <li><a href="/llxprt-code/docs/telemetry-privacy.html">Telemetry Privacy</a></li>
          <li><a href="/llxprt-code/docs/gemini-cli-tips.html">Migration from Gemini CLI</a></li>
          <li><a href="/llxprt-code/docs/architecture.html">Architecture Overview</a></li>
          <li><a href="/llxprt-code/docs/core/index.html">Core Introduction</a></li>
          <li><a href="/llxprt-code/docs/core/provider-runtime-context.html">Provider runtime context</a></li>
          <li><a href="/llxprt-code/docs/core/provider-interface.html">Provider interface</a></li>
          <li><a href="/llxprt-code/docs/core/tools-api.html">Tools API</a></li>
          <li><a href="/llxprt-code/docs/core/memport.html">Memory Import Processor</a></li>
          <li><a href="/llxprt-code/docs/shell-replacement.html">Shell Replacement</a></li>
          <li><a href="/llxprt-code/docs/../CONTRIBUTING.html">Contributing & Development Guide</a></li>
          <li><a href="/llxprt-code/docs/npm.html">NPM Workspaces and Publishing</a></li>
          <li><a href="/llxprt-code/docs/migration/stateless-provider.html">Stateless provider migration</a></li>
          <li><a href="/llxprt-code/docs/tools/index.html">Tools Overview</a></li>
          <li><a href="/llxprt-code/docs/tools/file-system.html">File System Tools</a></li>
          <li><a href="/llxprt-code/docs/tools/multi-file.html">Multi-File Read Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/shell.html">Shell Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/mcp-server.html">MCP Server</a></li>
          <li><a href="/llxprt-code/docs/tools/web-fetch.html">Web Fetch Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/web-search.html">Web Search Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/memory.html">Memory Tool</a></li>
          <li><a href="/llxprt-code/docs/release-notes/stateless-provider.html">Release notes: Stateless Provider</a></li>
          <li><a href="/llxprt-code/docs/tos-privacy.html">Terms of Service and Privacy Notice</a></li>
        </ul>
      </nav>
        <div class="docs-content">
          <div class="blog-post-content">
            <h1>Migrating from Approval Mode to Policies</h1>
<h2>Overview</h2>
<p>This guide helps users migrate from the legacy ApprovalMode system to the new policy engine. The policy engine provides more flexibility and control while maintaining backward compatibility with existing configurations.</p>
<h2>Why Migrate?</h2>
<p>The policy engine offers several advantages over ApprovalMode:</p>
<ol>
<li><strong>Fine-grained control</strong>: Define rules per tool or argument pattern</li>
<li><strong>Security</strong>: Block dangerous commands at the policy level</li>
<li><strong>Transparency</strong>: Use <code>/policies</code> to see exactly what rules are active</li>
<li><strong>Composability</strong>: Combine multiple rule sources seamlessly</li>
<li><strong>Extensibility</strong>: Integrate MCP server trust with tool policies</li>
</ol>
<h2>Backward Compatibility</h2>
<p><strong>Important:</strong> The policy engine maintains full backward compatibility. Your existing configurations continue to work:</p>
<ul>
<li><code>--yolo</code> flag still enables unrestricted mode</li>
<li><code>--approval-mode auto_edit</code> still auto-approves write tools</li>
<li><code>--allowed-tools</code> still allows specific tools</li>
<li>Settings.json <code>approvalMode</code> field still works</li>
</ul>
<p>The message bus and policy engine now power every confirmation. Legacy settings are converted into equivalent policy rules automatically, so behavior remains consistent without any toggles.</p>
<h2>How Legacy Settings Map to Policies</h2>
<h3>ApprovalMode.DEFAULT</h3>
<p><strong>Legacy behavior:</strong> Prompt for write tools, auto-approve read-only tools</p>
<p><strong>Policy equivalent:</strong> Standard policy stack applies</p>
<pre><code class="language-toml"># Built-in defaults (priority 1.05)
[[rule]]
toolName = &quot;glob&quot;
decision = &quot;allow&quot;
priority = 1.05

[[rule]]
toolName = &quot;grep&quot;
decision = &quot;allow&quot;
priority = 1.05

# ... other read-only tools

# Built-in defaults (priority 1.01)
[[rule]]
toolName = &quot;edit&quot;
decision = &quot;ask_user&quot;
priority = 1.01

[[rule]]
toolName = &quot;write_file&quot;
decision = &quot;ask_user&quot;
priority = 1.01

# ... other write tools
</code></pre>
<p><strong>Migration:</strong> No action needed — this is now the default behavior because the policy engine/message bus path is always active.</p>
<h3>ApprovalMode.AUTO_EDIT</h3>
<p><strong>Legacy behavior:</strong> Auto-approve write tools (edit, write_file, shell, memory)</p>
<p><strong>Policy equivalent:</strong> Allow rules at priority 1.015</p>
<pre><code class="language-toml">[[rule]]
toolName = &quot;edit&quot;
decision = &quot;allow&quot;
priority = 1.015

[[rule]]
toolName = &quot;write_file&quot;
decision = &quot;allow&quot;
priority = 1.015

[[rule]]
toolName = &quot;shell&quot;
decision = &quot;allow&quot;
priority = 1.015

[[rule]]
toolName = &quot;memory&quot;
decision = &quot;allow&quot;
priority = 1.015
</code></pre>
<p><strong>Migration:</strong></p>
<ol>
<li>Remove <code>approvalMode: &quot;auto_edit&quot;</code> from settings</li>
<li>Create a custom policy file with write tools allowed at priority 2.5+</li>
<li>Restart llxprt-code (or reload settings) so the new policy file is picked up</li>
</ol>
<h3>ApprovalMode.YOLO</h3>
<p><strong>Legacy behavior:</strong> Auto-approve all tools without confirmation</p>
<p><strong>Policy equivalent:</strong> Wildcard allow-all at priority 1.999</p>
<pre><code class="language-toml">[[rule]]
# No toolName = wildcard (matches all tools)
decision = &quot;allow&quot;
priority = 1.999
</code></pre>
<p><strong>Migration:</strong></p>
<ol>
<li>Remove <code>approvalMode: &quot;yolo&quot;</code> from settings</li>
<li>Create a custom policy file with wildcard allow at priority 2.5+ (if desired)</li>
<li>Restart llxprt-code to ensure the new policy stack loads</li>
</ol>
<p><strong>Security Note:</strong> YOLO mode disables all safety checks. Consider using selective allow rules instead.</p>
<h2>CLI Flag Mapping</h2>
<h3>--allowed-tools</h3>
<p><strong>Legacy usage:</strong></p>
<pre><code class="language-bash">llxprt --allowed-tools edit,shell,glob
</code></pre>
<p><strong>Policy equivalent:</strong> Individual allow rules at priority 2.3</p>
<pre><code class="language-toml">[[rule]]
toolName = &quot;edit&quot;
decision = &quot;allow&quot;
priority = 2.3

[[rule]]
toolName = &quot;shell&quot;
decision = &quot;allow&quot;
priority = 2.3

[[rule]]
toolName = &quot;glob&quot;
decision = &quot;allow&quot;
priority = 2.3
</code></pre>
<p><strong>Migration:</strong></p>
<ol>
<li>Continue using <code>--allowed-tools</code> (it still works with policy engine)</li>
<li>Or create permanent policy file with higher priority (2.5+) to override</li>
</ol>
<h3>--yolo</h3>
<p><strong>Legacy usage:</strong></p>
<pre><code class="language-bash">llxprt --yolo
</code></pre>
<p><strong>Policy equivalent:</strong> Wildcard allow-all at priority 1.999</p>
<pre><code class="language-toml">[[rule]]
decision = &quot;allow&quot;
priority = 1.999
</code></pre>
<p><strong>Migration:</strong></p>
<ol>
<li>Continue using <code>--yolo</code> flag (it still works)</li>
<li>Or create permanent policy file with wildcard allow</li>
<li><strong>Recommended:</strong> Use selective allow rules instead for better security</li>
</ol>
<h2>Step-by-Step Migration</h2>
<h3>Step 1: Test with Default Policies</h3>
<p>Restart llxprt-code and verify behavior:</p>
<pre><code class="language-bash">llxprt
</code></pre>
<p>Run <code>/policies</code> to see active rules:</p>
<pre><code>&gt; /policies

Active Policy Rules:

  1.999 │ *                         │ allow    (YOLO mode)
  1.050 │ glob                      │ allow    (read-only default)
  1.010 │ edit                      │ ask_user (write default)

Default decision: ask_user
Non-interactive mode: false
</code></pre>
<p>Test a few tool executions to confirm expected behavior.</p>
<h3>Step 3: Create Custom Policy File (Optional)</h3>
<p>Create <code>~/.llxprt/my-policy.toml</code>:</p>
<pre><code class="language-toml"># My custom policies - override defaults

# Auto-approve read-only tools
[[rule]]
toolName = &quot;glob&quot;
decision = &quot;allow&quot;
priority = 2.5

[[rule]]
toolName = &quot;grep&quot;
decision = &quot;allow&quot;
priority = 2.5

# Require confirmation for write tools
[[rule]]
toolName = &quot;edit&quot;
decision = &quot;ask_user&quot;
priority = 2.5

# Block dangerous shell commands
[[rule]]
toolName = &quot;shell&quot;
argsPattern = &quot;rm\\s+-rf\\s+/&quot;
decision = &quot;deny&quot;
priority = 2.8

# Allow safe shell commands
[[rule]]
toolName = &quot;shell&quot;
argsPattern = &quot;^(ls|pwd|echo)&quot;
decision = &quot;allow&quot;
priority = 2.6

# Default deny for shell
[[rule]]
toolName = &quot;shell&quot;
decision = &quot;deny&quot;
priority = 2.5
</code></pre>
<h3>Step 4: Configure Policy Path</h3>
<p>Add to <code>~/.llxprt/settings.json</code>:</p>
<pre><code class="language-json">{
  &quot;tools&quot;: {
    &quot;policyPath&quot;: &quot;/Users/yourname/.llxprt/my-policy.toml&quot;
  }
}
</code></pre>
<p><strong>Important:</strong> Use absolute paths, not <code>~</code> or relative paths.</p>
<h3>Step 5: Verify and Test</h3>
<p>Restart llxprt-code and check policies:</p>
<pre><code class="language-bash">llxprt --command &quot;/policies&quot;
</code></pre>
<p>Verify your custom rules appear with correct priorities.</p>
<h3>Step 6: Remove Legacy Settings (Optional)</h3>
<p>Once satisfied with policy-based configuration, you can remove legacy settings:</p>
<pre><code class="language-json">{
  // Remove these:
  // &quot;approvalMode&quot;: &quot;auto_edit&quot;,

  // Keep these:
  &quot;tools&quot;: {
    &quot;policyPath&quot;: &quot;/Users/yourname/.llxprt/my-policy.toml&quot;
  }
}
</code></pre>
<h2>Common Migration Scenarios</h2>
<h3>Scenario 1: Developer Using AUTO_EDIT</h3>
<p><strong>Current setup:</strong></p>
<pre><code class="language-json">{
  &quot;approvalMode&quot;: &quot;auto_edit&quot;
}
</code></pre>
<p><strong>Migration to policies:</strong></p>
<ol>
<li>Create <code>~/.llxprt/dev-policy.toml</code>:</li>
</ol>
<pre><code class="language-toml"># Auto-approve write tools for development
[[rule]]
toolName = &quot;edit&quot;
decision = &quot;allow&quot;
priority = 2.5

[[rule]]
toolName = &quot;write_file&quot;
decision = &quot;allow&quot;
priority = 2.5

# Shell with safety checks
[[rule]]
toolName = &quot;shell&quot;
argsPattern = &quot;rm\\s+-rf\\s+/&quot;
decision = &quot;deny&quot;
priority = 2.8

[[rule]]
toolName = &quot;shell&quot;
decision = &quot;allow&quot;
priority = 2.5

# Memory operations
[[rule]]
toolName = &quot;memory&quot;
decision = &quot;allow&quot;
priority = 2.5
</code></pre>
<ol start="2">
<li>Update settings:</li>
</ol>
<pre><code class="language-json">{
  &quot;tools&quot;: {
    &quot;policyPath&quot;: &quot;/Users/yourname/.llxprt/dev-policy.toml&quot;
  }
}
</code></pre>
<h3>Scenario 2: Security-Conscious User</h3>
<p><strong>Current setup:</strong></p>
<pre><code class="language-json">{
  &quot;approvalMode&quot;: &quot;default&quot;
}
</code></pre>
<p><strong>Migration to policies:</strong></p>
<ol>
<li>Create <code>~/.llxprt/secure-policy.toml</code>:</li>
</ol>
<pre><code class="language-toml"># Read-only tools allowed
[[rule]]
toolName = &quot;glob&quot;
decision = &quot;allow&quot;
priority = 2.5

[[rule]]
toolName = &quot;grep&quot;
decision = &quot;allow&quot;
priority = 2.5

[[rule]]
toolName = &quot;read_file&quot;
decision = &quot;allow&quot;
priority = 2.5

# Write tools require confirmation
[[rule]]
toolName = &quot;edit&quot;
decision = &quot;ask_user&quot;
priority = 2.5

[[rule]]
toolName = &quot;write_file&quot;
decision = &quot;ask_user&quot;
priority = 2.5

# Shell completely blocked
[[rule]]
toolName = &quot;shell&quot;
decision = &quot;deny&quot;
priority = 2.5

# MCP tools require confirmation
[[rule]]
toolName = &quot;mcp_tool&quot;
decision = &quot;ask_user&quot;
priority = 2.5
</code></pre>
<ol start="2">
<li>Update settings:</li>
</ol>
<pre><code class="language-json">{
  &quot;tools&quot;: {
    &quot;policyPath&quot;: &quot;/Users/yourname/.llxprt/secure-policy.toml&quot;
  }
}
</code></pre>
<h3>Scenario 3: Per-Project Policies</h3>
<p><strong>Current setup:</strong> Different <code>--allowed-tools</code> for different projects</p>
<p><strong>Migration to policies:</strong></p>
<ol>
<li>Create project-specific policy file <code>.llxprt-policy.toml</code> in project root:</li>
</ol>
<pre><code class="language-toml"># Project-specific policies

# Allow edit only in project directory
[[rule]]
toolName = &quot;edit&quot;
argsPattern = &quot;/path/to/project/&quot;
decision = &quot;allow&quot;
priority = 2.7

# Block edit outside project
[[rule]]
toolName = &quot;edit&quot;
decision = &quot;deny&quot;
priority = 2.5

# Allow safe shell commands in project
[[rule]]
toolName = &quot;shell&quot;
argsPattern = &quot;cd /path/to/project&quot;
decision = &quot;allow&quot;
priority = 2.7

[[rule]]
toolName = &quot;shell&quot;
argsPattern = &quot;npm (install|test|build)&quot;
decision = &quot;allow&quot;
priority = 2.7

# Block other shell commands
[[rule]]
toolName = &quot;shell&quot;
decision = &quot;deny&quot;
priority = 2.5
</code></pre>
<ol start="2">
<li>Load policy when starting llxprt in project:</li>
</ol>
<pre><code class="language-bash">cd /path/to/project
export LLXPRT_POLICY_PATH=&quot;$(pwd)/.llxprt-policy.toml&quot;
llxprt
</code></pre>
<p>Or add to project-specific profile:</p>
<pre><code class="language-json">{
  &quot;profiles&quot;: {
    &quot;myproject&quot;: {
      &quot;tools.policyPath&quot;: &quot;/path/to/project/.llxprt-policy.toml&quot;
    }
  }
}
</code></pre>
<h2>Priority Precedence</h2>
<p>Understanding priority helps combine legacy and new settings:</p>
<pre><code>Higher Priority (wins)
    ↑
    │
3.xxx │ Admin policies (future)
    │
2.95  │ &quot;Always Allow&quot; UI selections
2.9   │ MCP servers excluded
2.5+  │ User TOML policies ← YOUR CUSTOM POLICIES
2.4   │ --exclude-tools
2.3   │ --allowed-tools ← CLI FLAG
2.2   │ MCP trust=true
2.1   │ MCP allowed list
2.0   │ Dangerous command blocks
    │
1.999 │ YOLO mode ← --yolo FLAG
1.05  │ Read-only defaults
1.015 │ AUTO_EDIT mode ← approvalMode setting
1.01  │ Write tool defaults
    │
    ↓
Lower Priority
</code></pre>
<p><strong>Key insight:</strong> Your custom policies at 2.5+ override CLI flags and ApprovalMode settings.</p>
<h2>Coexistence Strategy</h2>
<p>You can run both systems simultaneously during migration:</p>
<h3>Phase 1: Test with Feature Flag</h3>
<pre><code class="language-json">{
  &quot;approvalMode&quot;: &quot;auto_edit&quot; // Keep legacy
}
</code></pre>
<ul>
<li>Legacy settings are still migrated to policy rules automatically</li>
<li>No breaking changes</li>
<li>Test new system alongside legacy</li>
</ul>
<h3>Phase 2: Add Custom Policies</h3>
<pre><code class="language-json">{
  &quot;approvalMode&quot;: &quot;auto_edit&quot;, // Keep legacy
  &quot;tools&quot;: {
    &quot;policyPath&quot;: &quot;/path/to/my-policy.toml&quot; // Add custom
  }
}
</code></pre>
<ul>
<li>Custom policies override legacy (due to priority)</li>
<li>Gradual transition to declarative config</li>
</ul>
<h3>Phase 3: Remove Legacy</h3>
<pre><code class="language-json">{
  &quot;tools&quot;: {
    &quot;policyPath&quot;: &quot;/path/to/my-policy.toml&quot; // Only new system
  }
}
</code></pre>
<ul>
<li>Fully migrated to policy engine</li>
<li>No legacy settings</li>
</ul>
<h2>Troubleshooting Migration</h2>
<h3>Issue: Policies Not Taking Effect</h3>
<p><strong>Symptoms:</strong> Tools still prompt for confirmation despite allow rules</p>
<p><strong>Solutions:</strong></p>
<ol>
<li>Restart llxprt-code after changing settings</li>
<li>Verify policies loaded: <code>llxprt --command &quot;/policies&quot;</code></li>
<li>Check priority - your rules must be higher than defaults (use 2.5+)</li>
<li>Ensure policy file path is absolute</li>
</ol>
<h3>Issue: TOML Parse Errors</h3>
<p><strong>Symptoms:</strong> llxprt-code fails to start or logs TOML errors</p>
<p><strong>Solutions:</strong></p>
<ol>
<li>Validate TOML syntax: <a href="https://www.toml-lint.com/">https://www.toml-lint.com/</a></li>
<li>Check for common mistakes:
<ul>
<li>Missing quotes on <code>decision = &quot;allow&quot;</code></li>
<li>Single backslash in regex (use <code>\\</code> not <code>\</code>)</li>
<li>Wrong array syntax (use <code>[[rule]]</code> not <code>[rule]</code>)</li>
</ul>
</li>
<li>Review error message for line number</li>
<li>Temporarily remove custom policy path to isolate issue</li>
</ol>
<h3>Issue: Rules Conflicting</h3>
<p><strong>Symptoms:</strong> Unexpected allow/deny behavior</p>
<p><strong>Solutions:</strong></p>
<ol>
<li>Run <code>/policies</code> to see all active rules in priority order</li>
<li>Check for rules with higher priority overriding your rules</li>
<li>Review argsPattern for overly broad matches</li>
<li>Remember: highest priority wins</li>
<li>Use priority 2.8+ for critical deny rules</li>
</ol>
<h3>Issue: Legacy Flags Not Working</h3>
<p><strong>Symptoms:</strong> <code>--allowed-tools</code> or <code>--yolo</code> not working as expected</p>
<p><strong>Solutions:</strong></p>
<ol>
<li>Ensure you're running a build that includes the policy engine/message bus stack (20251119gmerge or later)</li>
<li>Check for custom policies with higher priority overriding flags</li>
<li>Use <code>/policies</code> to see how flags translated to rules</li>
<li>Remember: CLI flags have priority 2.3, user policies at 2.5+ override them</li>
</ol>
<h3>Issue: MCP Tools Not Allowed</h3>
<p><strong>Symptoms:</strong> MCP server tools blocked despite trust settings</p>
<p><strong>Solutions:</strong></p>
<ol>
<li>Check MCP server name prefix: <code>serverName__toolName</code></li>
<li>Create explicit policy rule for MCP server:<pre><code class="language-toml">[[rule]]
toolName = &quot;my-server__&quot;
decision = &quot;allow&quot;
priority = 2.2
</code></pre>
</li>
<li>Verify <code>mcpServers.*.trust: true</code> in settings</li>
<li>Check for deny rules with higher priority</li>
</ol>
<h2>Best Practices</h2>
<h3>1. Start Conservative</h3>
<p>Begin with restrictive policies and loosen as needed:</p>
<pre><code class="language-toml"># Start with deny-by-default
[[rule]]
decision = &quot;deny&quot;
priority = 2.5

# Allow only specific tools
[[rule]]
toolName = &quot;read_file&quot;
decision = &quot;allow&quot;
priority = 2.6

[[rule]]
toolName = &quot;edit&quot;
decision = &quot;ask_user&quot;
priority = 2.6
</code></pre>
<h3>2. Use Comments Liberally</h3>
<p>Document why each rule exists:</p>
<pre><code class="language-toml"># Allow edit for project files only (2024-11-20)
# Prevents accidental edits to system files
[[rule]]
toolName = &quot;edit&quot;
argsPattern = &quot;/home/user/projects/&quot;
decision = &quot;allow&quot;
priority = 2.6
</code></pre>
<h3>3. Version Control Policies</h3>
<p>Store policy files in git alongside your project:</p>
<pre><code class="language-bash">project/
  .llxprt-policy.toml  # Project-specific policies
  .gitignore
  README.md
</code></pre>
<h3>4. Test Policies Before Deployment</h3>
<p>Create test policy file and verify behavior:</p>
<pre><code class="language-bash"># Create test policy
cat &gt; /tmp/test-policy.toml &lt;&lt; 'EOF'
[[rule]]
toolName = &quot;edit&quot;
decision = &quot;allow&quot;
priority = 2.5
EOF

# Test it
llxprt --config &quot;tools.policyPath=/tmp/test-policy.toml&quot;

# Verify
&gt; /policies
</code></pre>
<h3>5. Use Profiles for Different Contexts</h3>
<p>Create profiles for different use cases:</p>
<pre><code class="language-json">{
  &quot;profiles&quot;: {
    &quot;dev&quot;: {
      &quot;tools.policyPath&quot;: &quot;/Users/me/.llxprt/dev-policy.toml&quot;
    },
    &quot;secure&quot;: {
      &quot;tools.policyPath&quot;: &quot;/Users/me/.llxprt/secure-policy.toml&quot;
    },
    &quot;demo&quot;: {
      &quot;tools.policyPath&quot;: &quot;/Users/me/.llxprt/demo-policy.toml&quot;
    }
  }
}
</code></pre>
<p>Switch profiles as needed:</p>
<pre><code class="language-bash">llxprt --profile dev
llxprt --profile secure
</code></pre>
<h2>Migration Checklist</h2>
<ul>
<li>[ ] Backup existing settings.json</li>
<li>[ ] Test with default policies</li>
<li>[ ] Run <code>/policies</code> to verify rules</li>
<li>[ ] Create custom policy file (if needed)</li>
<li>[ ] Configure policy path in settings</li>
<li>[ ] Restart llxprt-code</li>
<li>[ ] Verify custom rules loaded</li>
<li>[ ] Test tool executions</li>
<li>[ ] Document policy decisions (comments in TOML)</li>
<li>[ ] Version control policy files</li>
<li>[ ] Remove legacy settings (optional)</li>
</ul>
<h2>Rollback Plan</h2>
<p>If you need to revert to the previous behavior, remove custom policy files/paths and rely on <code>approvalMode</code> plus <code>--allowed-tools</code> flags. Message bus integration remains enabled, but without custom policies the behavior mirrors the legacy flow.</p>
<h2>Next Steps</h2>
<ul>
<li>Read <a href="../message-bus.html">Message Bus Guide</a> for detailed feature overview</li>
<li>Read <a href="../policy-configuration.html">Policy Configuration Guide</a> for TOML syntax and examples</li>
<li>Review <a href="../architecture/message-bus-architecture.html">Architecture Document</a> for implementation details</li>
<li>See <a href="https://github.com/vybestack/llxprt-code/tree/main/packages/core/src/policy/policies">example policies</a> in the repository</li>
</ul>

          </div>
        </div>
      </div>
    </div>
  </section>


  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>Vybestack</h4>
        <p>Beyond vibe coding. Autonomous development for ascending engineers.</p>
      </div>
      <div class="footer-section">
        <h4>Products</h4>
        <ul>
          <li><a href="/llxprt-code.html">LLxprt Code</a></li>
          <li><a href="/jefe.html">LLxprt Jefe</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Content</h4>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/#podcast">Podcast</a></li>
          <li><a href="/llxprt-code/docs/">Documentation</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Connect</h4>
        <ul class="social-links">
          <li><a href="https://github.com/vybestack/llxprt-code"><img src="/assets/github-mark-white.svg" alt="GitHub" /> </a></li>
          <li><a href="https://discord.gg/Wc6dZqWWYv"><img src="/assets/discord-mark-white.svg" alt="Discord" /></a></li>
          <li><a href="https://www.linkedin.com/company/vybestack/"><img src="/assets/linkedin-white.svg" alt="LinkedIn" /></a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Vybestack. Apache 2.0 License. Built for the terminal.</p>
    </div>
  </footer>

</body>
</html>