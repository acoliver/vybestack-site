<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hook System API Reference | LLxprt Code Docs</title>
  <link rel="stylesheet" href="../../../vybestack.css" />
</head>
<body>

  <nav>
    <div class="nav-container">
      <div class="nav-left">
        <a href="/" class="logo">
          <img src="/assets/vybestack_logo.png" alt="Vybestack" />
        </a>
        <span class="tagline">Beyond Vibe Coding</span>
      </div>
      <div class="nav-right">
        <div class="nav-dropdown">
          <a href="/llxprt-code.html">LLxprt Code</a>
          <div class="nav-dropdown-menu">
            <a href="/llxprt-code.html">Overview</a>
            <a href="/llxprt-code/docs/">Documentation</a>
          </div>
        </div>
        <a href="/jefe.html">LLxprt Jefe</a>
        <a href="/blog/">Blog</a>
        <a href="/#podcast">Podcast</a>
        <a href="https://discord.gg/Wc6dZqWWYv" target="_blank">Discord</a>
      </div>
    </div>
  </nav>


  <section class="section docs-section">
    <div class="container-wide">
      <div class="docs-layout">

      <nav class="docs-sidebar">
        <h3><a href="/llxprt-code/docs/">Documentation</a></h3>
        <ul>
          <li><a href="/llxprt-code/docs/getting-started.html">Getting Started Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/providers.html">Provider Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/authentication.html">Authentication</a></li>
          <li><a href="/llxprt-code/docs/cli/profiles.html">Profiles</a></li>
          <li><a href="/llxprt-code/docs/sandbox.html">Sandboxing</a></li>
          <li><a href="/llxprt-code/docs/subagents.html">Subagents</a></li>
          <li><a href="/llxprt-code/docs/oauth-setup.html">OAuth Setup</a></li>
          <li><a href="/llxprt-code/docs/local-models.html">Local Models</a></li>
          <li><a href="/llxprt-code/docs/zed-integration.html">Zed Editor Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/providers-openai-responses.html">OpenAI Responses API</a></li>
          <li><a href="/llxprt-code/docs/prompt-configuration.html">Prompt Configuration</a></li>
          <li><a href="/llxprt-code/docs/settings-and-profiles.html">Settings and Profiles</a></li>
          <li><a href="/llxprt-code/docs/checkpointing.html">Checkpointing</a></li>
          <li><a href="/llxprt-code/docs/extension.html">Extensions</a></li>
          <li><a href="/llxprt-code/docs/ide-integration.html">IDE Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/configuration.html">Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/commands.html">Commands Reference</a></li>
          <li><a href="/llxprt-code/docs/troubleshooting.html">Troubleshooting Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/index.html">CLI Introduction</a></li>
          <li><a href="/llxprt-code/docs/deployment.html">Execution and Deployment</a></li>
          <li><a href="/llxprt-code/docs/keyboard-shortcuts.html">Keyboard Shortcuts</a></li>
          <li><a href="/llxprt-code/docs/cli/themes.html">Themes</a></li>
          <li><a href="/llxprt-code/docs/EMOJI-FILTER.html">Emoji Filter</a></li>
          <li><a href="/llxprt-code/docs/cli/runtime-helpers.html">Runtime helper APIs</a></li>
          <li><a href="/llxprt-code/docs/cli/context-dumping.html">Context Dumping</a></li>
          <li><a href="/llxprt-code/docs/telemetry.html">Telemetry</a></li>
          <li><a href="/llxprt-code/docs/telemetry-privacy.html">Telemetry Privacy</a></li>
          <li><a href="/llxprt-code/docs/gemini-cli-tips.html">Migration from Gemini CLI</a></li>
          <li><a href="/llxprt-code/docs/architecture.html">Architecture Overview</a></li>
          <li><a href="/llxprt-code/docs/core/index.html">Core Introduction</a></li>
          <li><a href="/llxprt-code/docs/core/provider-runtime-context.html">Provider runtime context</a></li>
          <li><a href="/llxprt-code/docs/core/provider-interface.html">Provider interface</a></li>
          <li><a href="/llxprt-code/docs/core/tools-api.html">Tools API</a></li>
          <li><a href="/llxprt-code/docs/core/memport.html">Memory Import Processor</a></li>
          <li><a href="/llxprt-code/docs/shell-replacement.html">Shell Replacement</a></li>
          <li><a href="/llxprt-code/docs/../CONTRIBUTING.html">Contributing & Development Guide</a></li>
          <li><a href="/llxprt-code/docs/npm.html">NPM Workspaces and Publishing</a></li>
          <li><a href="/llxprt-code/docs/migration/stateless-provider.html">Stateless provider migration</a></li>
          <li><a href="/llxprt-code/docs/tools/index.html">Tools Overview</a></li>
          <li><a href="/llxprt-code/docs/tools/file-system.html">File System Tools</a></li>
          <li><a href="/llxprt-code/docs/tools/multi-file.html">Multi-File Read Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/shell.html">Shell Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/mcp-server.html">MCP Server</a></li>
          <li><a href="/llxprt-code/docs/tools/web-fetch.html">Web Fetch Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/web-search.html">Web Search Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/memory.html">Memory Tool</a></li>
          <li><a href="/llxprt-code/docs/release-notes/stateless-provider.html">Release notes: Stateless Provider</a></li>
          <li><a href="/llxprt-code/docs/tos-privacy.html">Terms of Service and Privacy Notice</a></li>
        </ul>
      </nav>
        <div class="docs-content">
          <div class="blog-post-content">
            <h1>Hook System API Reference</h1>
<p>This document provides complete type definitions and interface specifications for the LLxprt Code hook system.</p>
<h2>Configuration Schema</h2>
<h3>Hook Configuration in settings.json</h3>
<pre><code class="language-typescript">interface SettingsHooks {
  hooks: {
    [eventName: string]: HookDefinition[];
  };
}
</code></pre>
<h3>HookDefinition</h3>
<pre><code class="language-typescript">interface HookDefinition {
  /** Pattern to match against context (e.g., tool name). Optional. */
  matcher?: string;

  /** If true, hooks in this group run sequentially. Default: false */
  sequential?: boolean;

  /** Array of hook configurations to execute */
  hooks: HookConfig[];
}
</code></pre>
<h3>HookConfig</h3>
<pre><code class="language-typescript">interface CommandHookConfig {
  /** Must be &quot;command&quot; */
  type: 'command';

  /** Shell command to execute. Supports ~ expansion. */
  command: string;

  /** Timeout in milliseconds. Default: 60000 (60 seconds) */
  timeout?: number;
}

type HookConfig = CommandHookConfig;
</code></pre>
<h3>Example Configuration</h3>
<pre><code class="language-json">{
  &quot;hooks&quot;: {
    &quot;BeforeTool&quot;: [
      {
        &quot;matcher&quot;: &quot;write_*&quot;,
        &quot;sequential&quot;: false,
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/security.sh&quot;,
            &quot;timeout&quot;: 5000
          }
        ]
      }
    ],
    &quot;AfterTool&quot;: [
      {
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/audit.sh&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>
<h2>Hook Event Types</h2>
<pre><code class="language-typescript">enum HookEventName {
  BeforeTool = 'BeforeTool',
  AfterTool = 'AfterTool',
  BeforeAgent = 'BeforeAgent',
  AfterAgent = 'AfterAgent',
  BeforeModel = 'BeforeModel',
  AfterModel = 'AfterModel',
  BeforeToolSelection = 'BeforeToolSelection',
  SessionStart = 'SessionStart',
  SessionEnd = 'SessionEnd',
  PreCompress = 'PreCompress',
  Notification = 'Notification',
}
</code></pre>
<h2>Input Interfaces</h2>
<h3>Base HookInput</h3>
<p>All hook inputs include these fields:</p>
<pre><code class="language-typescript">interface HookInput {
  /** Unique session identifier */
  session_id: string;

  /** Path to session transcript (may be empty) */
  transcript_path: string;

  /** Current working directory */
  cwd: string;

  /** Name of the hook event */
  hook_event_name: string;

  /** ISO 8601 timestamp */
  timestamp: string;
}
</code></pre>
<h3>BeforeToolInput</h3>
<pre><code class="language-typescript">interface BeforeToolInput extends HookInput {
  /** Name of the tool being called */
  tool_name: string;

  /** Tool parameters */
  tool_input: Record&lt;string, unknown&gt;;
}
</code></pre>
<p><strong>Example:</strong></p>
<pre><code class="language-json">{
  &quot;session_id&quot;: &quot;abc123&quot;,
  &quot;hook_event_name&quot;: &quot;BeforeTool&quot;,
  &quot;cwd&quot;: &quot;/home/user/project&quot;,
  &quot;timestamp&quot;: &quot;2025-02-18T16:30:00.000Z&quot;,
  &quot;transcript_path&quot;: &quot;&quot;,
  &quot;tool_name&quot;: &quot;write_file&quot;,
  &quot;tool_input&quot;: {
    &quot;path&quot;: &quot;/home/user/project/file.txt&quot;,
    &quot;content&quot;: &quot;Hello, world!&quot;
  }
}
</code></pre>
<h3>AfterToolInput</h3>
<pre><code class="language-typescript">interface AfterToolInput extends HookInput {
  /** Name of the tool that was called */
  tool_name: string;

  /** Tool parameters that were used */
  tool_input: Record&lt;string, unknown&gt;;

  /** Result returned by the tool */
  tool_response: Record&lt;string, unknown&gt;;
}
</code></pre>
<h3>BeforeModelInput</h3>
<pre><code class="language-typescript">interface BeforeModelInput extends HookInput {
  /** LLM request in simplified hook format */
  llm_request: LLMRequest;
}

interface LLMRequest {
  model?: string;
  contents?: Array&lt;{
    role: 'user' | 'model';
    parts: Array&lt;string | { text: string }&gt;;
  }&gt;;
  systemInstruction?: {
    role: 'system';
    parts: Array&lt;string | { text: string }&gt;;
  };
  generationConfig?: {
    temperature?: number;
    maxOutputTokens?: number;
    topP?: number;
    topK?: number;
    stopSequences?: string[];
  };
}
</code></pre>
<h3>AfterModelInput</h3>
<pre><code class="language-typescript">interface AfterModelInput extends HookInput {
  /** Original request */
  llm_request: LLMRequest;

  /** LLM response */
  llm_response: LLMResponse;
}

interface LLMResponse {
  candidates?: Array&lt;{
    content: {
      role: 'model';
      parts: Array&lt;string | { text: string }&gt;;
    };
    finishReason?: string;
  }&gt;;
}
</code></pre>
<h3>BeforeToolSelectionInput</h3>
<pre><code class="language-typescript">interface BeforeToolSelectionInput extends HookInput {
  /** Current LLM request */
  llm_request: LLMRequest;
}
</code></pre>
<h3>SessionStartInput</h3>
<pre><code class="language-typescript">interface SessionStartInput extends HookInput {
  /** How the session was started */
  source: 'startup' | 'resume' | 'clear' | 'compress';
}
</code></pre>
<h3>SessionEndInput</h3>
<pre><code class="language-typescript">interface SessionEndInput extends HookInput {
  /** Why the session ended */
  reason: 'exit' | 'clear' | 'logout' | 'prompt_input_exit' | 'other';
}
</code></pre>
<h3>BeforeAgentInput</h3>
<pre><code class="language-typescript">interface BeforeAgentInput extends HookInput {
  /** User prompt being processed */
  prompt: string;
}
</code></pre>
<h3>AfterAgentInput</h3>
<pre><code class="language-typescript">interface AfterAgentInput extends HookInput {
  /** Original user prompt */
  prompt: string;

  /** Agent's response */
  prompt_response: string;

  /** Whether a stop hook is active */
  stop_hook_active: boolean;
}
</code></pre>
<h2>Output Interfaces</h2>
<h3>Base HookOutput</h3>
<pre><code class="language-typescript">interface HookOutput {
  /** Set to false to stop execution */
  continue?: boolean;

  /** Reason for stopping (when continue=false) */
  stopReason?: string;

  /** Hide output from user */
  suppressOutput?: boolean;

  /** Message to inject into conversation */
  systemMessage?: string;

  /** Permission decision */
  decision?: HookDecision;

  /** Explanation for decision */
  reason?: string;

  /** Event-specific output data */
  hookSpecificOutput?: Record&lt;string, unknown&gt;;
}

type HookDecision = 'ask' | 'block' | 'deny' | 'approve' | 'allow' | undefined;
</code></pre>
<h3>BeforeToolOutput</h3>
<pre><code class="language-typescript">interface BeforeToolOutput extends HookOutput {
  hookSpecificOutput?: {
    hookEventName: 'BeforeTool';

    /** Permission decision (compatibility) */
    permissionDecision?: HookDecision;

    /** Reason for decision (compatibility) */
    permissionDecisionReason?: string;

    /** Modified tool input (overrides original) */
    tool_input?: Record&lt;string, unknown&gt;;
  };
}
</code></pre>
<p><strong>Example - Block:</strong></p>
<pre><code class="language-json">{
  &quot;decision&quot;: &quot;deny&quot;,
  &quot;reason&quot;: &quot;Writing to /etc is prohibited&quot;
}
</code></pre>
<p><strong>Example - Modify Input:</strong></p>
<pre><code class="language-json">{
  &quot;decision&quot;: &quot;allow&quot;,
  &quot;hookSpecificOutput&quot;: {
    &quot;tool_input&quot;: {
      &quot;path&quot;: &quot;/safe/path/file.txt&quot;,
      &quot;content&quot;: &quot;Modified content&quot;
    }
  }
}
</code></pre>
<h3>AfterToolOutput</h3>
<pre><code class="language-typescript">interface AfterToolOutput extends HookOutput {
  hookSpecificOutput?: {
    hookEventName: 'AfterTool';

    /** Additional context to add to the response */
    additionalContext?: string;
  };
}
</code></pre>
<h3>BeforeModelOutput</h3>
<pre><code class="language-typescript">interface BeforeModelOutput extends HookOutput {
  hookSpecificOutput?: {
    hookEventName: 'BeforeModel';

    /** Modified LLM request (merged with original) */
    llm_request?: Partial&lt;LLMRequest&gt;;

    /** Synthetic response (skips actual LLM call) */
    llm_response?: LLMResponse;
  };
}
</code></pre>
<h3>AfterModelOutput</h3>
<pre><code class="language-typescript">interface AfterModelOutput extends HookOutput {
  hookSpecificOutput?: {
    hookEventName: 'AfterModel';

    /** Modified response */
    llm_response?: Partial&lt;LLMResponse&gt;;
  };
}
</code></pre>
<h3>BeforeToolSelectionOutput</h3>
<pre><code class="language-typescript">interface BeforeToolSelectionOutput extends HookOutput {
  hookSpecificOutput?: {
    hookEventName: 'BeforeToolSelection';

    /** Tool configuration */
    toolConfig?: HookToolConfig;
  };
}

interface HookToolConfig {
  /** Tool selection mode */
  mode?: 'AUTO' | 'ANY' | 'NONE';

  /** Explicitly allowed function names */
  allowedFunctionNames?: string[];
}
</code></pre>
<p><strong>Example - Restrict Tools:</strong></p>
<pre><code class="language-json">{
  &quot;hookSpecificOutput&quot;: {
    &quot;toolConfig&quot;: {
      &quot;mode&quot;: &quot;AUTO&quot;,
      &quot;allowedFunctionNames&quot;: [&quot;read_file&quot;, &quot;list_directory&quot;, &quot;glob&quot;]
    }
  }
}
</code></pre>
<h2>Aggregated Results</h2>
<h3>AggregatedHookResult</h3>
<p>Returned by the hook system after all hooks for an event complete:</p>
<pre><code class="language-typescript">interface AggregatedHookResult {
  /** True if all hooks succeeded */
  success: boolean;

  /** Merged final output */
  finalOutput?: DefaultHookOutput;

  /** All individual hook outputs */
  allOutputs: HookOutput[];

  /** Any errors that occurred */
  errors: Error[];

  /** Total execution time in milliseconds */
  totalDuration: number;
}
</code></pre>
<h3>ProcessedHookResult</h3>
<p>Processed result with common-output semantics applied:</p>
<pre><code class="language-typescript">interface ProcessedHookResult {
  /** Raw aggregated result */
  aggregated: AggregatedHookResult;

  /** Should execution stop? */
  shouldStop: boolean;

  /** Reason for stopping */
  stopReason: string | undefined;

  /** System message to inject */
  systemMessage: string | undefined;

  /** Should output be suppressed? */
  suppressOutput: boolean;
}
</code></pre>
<h2>Exit Codes</h2>
<table>
<thead>
<tr>
<th>Code</th>
<th>Constant</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td><code>EXIT_CODE_SUCCESS</code></td>
<td>Hook completed successfully</td>
</tr>
<tr>
<td>1</td>
<td><code>EXIT_CODE_NON_BLOCKING_ERROR</code></td>
<td>Warning, execution continues</td>
</tr>
<tr>
<td>2</td>
<td><code>EXIT_CODE_BLOCKING_ERROR</code></td>
<td>Block/deny the operation</td>
</tr>
</tbody>
</table>
<h2>Environment Variables</h2>
<p>Hooks receive these environment variables:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LLXPRT_PROJECT_DIR</code></td>
<td>Current working directory</td>
</tr>
<tr>
<td><code>GEMINI_PROJECT_DIR</code></td>
<td>Alias for compatibility</td>
</tr>
<tr>
<td><code>CLAUDE_PROJECT_DIR</code></td>
<td>Alias for compatibility</td>
</tr>
</tbody>
</table>
<h2>MessageBus Contracts</h2>
<p>For advanced integration via the internal message bus:</p>
<h3>HookExecutionRequest</h3>
<pre><code class="language-typescript">interface HookExecutionRequest {
  /** Correlation ID for tracking */
  correlationId: string;

  /** Event to fire */
  eventName: HookEventName;

  /** Event input data */
  input: HookInput;
}
</code></pre>
<h3>HookExecutionResponse</h3>
<pre><code class="language-typescript">interface HookExecutionResponse {
  /** Matches request correlationId */
  correlationId: string;

  /** Whether execution succeeded */
  success: boolean;

  /** Result if successful */
  output?: AggregatedHookResult;

  /** Error if failed */
  error?: {
    code: string;
    message: string;
  };
}
</code></pre>
<h3>Channel Names</h3>
<table>
<thead>
<tr>
<th>Channel</th>
<th>Direction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HOOK_EXECUTION_REQUEST</code></td>
<td>Incoming</td>
<td>Trigger hook execution</td>
</tr>
<tr>
<td><code>HOOK_EXECUTION_RESPONSE</code></td>
<td>Outgoing</td>
<td>Hook execution result</td>
</tr>
</tbody>
</table>
<h2>Hook Output Classes</h2>
<p>The hook system provides output classes with utility methods:</p>
<h3>DefaultHookOutput</h3>
<pre><code class="language-typescript">class DefaultHookOutput implements HookOutput {
  /** Check if this represents a blocking decision */
  isBlockingDecision(): boolean;

  /** Check if execution should stop */
  shouldStopExecution(): boolean;

  /** Get the effective reason for blocking/stopping */
  getEffectiveReason(): string;

  /** Get additional context if provided */
  getAdditionalContext(): string | undefined;

  /** Get blocking error info */
  getBlockingError(): { blocked: boolean; reason: string };
}
</code></pre>
<h3>BeforeToolHookOutput</h3>
<pre><code class="language-typescript">class BeforeToolHookOutput extends DefaultHookOutput {
  /** Get modified tool input if provided */
  getModifiedToolInput(): Record&lt;string, unknown&gt; | undefined;
}
</code></pre>
<h3>BeforeModelHookOutput</h3>
<pre><code class="language-typescript">class BeforeModelHookOutput extends DefaultHookOutput {
  /** Get synthetic response if provided */
  getSyntheticResponse(): GenerateContentResponse | undefined;

  /** Apply modifications to LLM request */
  applyLLMRequestModifications(
    target: GenerateContentParameters,
  ): GenerateContentParameters;
}
</code></pre>
<h3>BeforeToolSelectionHookOutput</h3>
<pre><code class="language-typescript">class BeforeToolSelectionHookOutput extends DefaultHookOutput {
  /** Apply tool configuration modifications */
  applyToolConfigModifications(target: {
    toolConfig?: GenAIToolConfig;
    tools?: ToolListUnion;
  }): {
    toolConfig?: GenAIToolConfig;
    tools?: ToolListUnion;
  };
}
</code></pre>
<h3>AfterModelHookOutput</h3>
<pre><code class="language-typescript">class AfterModelHookOutput extends DefaultHookOutput {
  /** Get modified response if provided */
  getModifiedResponse(): GenerateContentResponse | undefined;
}
</code></pre>
<h2>Aggregation Strategies</h2>
<h3>OR Decision Logic (BeforeTool, AfterTool)</h3>
<ul>
<li>Any <code>block</code> or <code>deny</code> decision â†’ aggregated result is blocked</li>
<li>Messages (<code>reason</code>, <code>systemMessage</code>) are concatenated</li>
<li><code>suppressOutput</code> uses OR logic (any true wins)</li>
<li>Default decision is <code>allow</code> if no blocking</li>
</ul>
<h3>Field Replacement (BeforeModel, AfterModel)</h3>
<ul>
<li>Later hook outputs override earlier ones</li>
<li><code>hookSpecificOutput</code> fields are merged (last write wins)</li>
</ul>
<h3>Tool Selection (BeforeToolSelection)</h3>
<ul>
<li><code>allowedFunctionNames</code> are unioned across all hooks</li>
<li><code>NONE</code> mode wins if any hook uses it</li>
<li>Otherwise <code>ANY</code> if any hook uses it, else <code>AUTO</code></li>
<li>Results are sorted for deterministic behavior</li>
</ul>

          </div>
        </div>
      </div>
    </div>
  </section>


  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>Vybestack</h4>
        <p>Beyond vibe coding. Autonomous development for ascending engineers.</p>
      </div>
      <div class="footer-section">
        <h4>Products</h4>
        <ul>
          <li><a href="/llxprt-code.html">LLxprt Code</a></li>
          <li><a href="/jefe.html">LLxprt Jefe</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Content</h4>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/#podcast">Podcast</a></li>
          <li><a href="/llxprt-code/docs/">Documentation</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Connect</h4>
        <ul class="footer-icons">
<li><a href="https://github.com/vybestack/llxprt-code"><img src="/assets/icons/github.svg" alt="GitHub" /> </a></li>
<li><a href="https://discord.gg/Wc6dZqWWYv"><img src="/assets/icons/discord.svg" alt="Discord" /></a></li>
<li><a href="https://www.linkedin.com/company/vybestack/"><img src="/assets/icons/linkedin.svg" alt="LinkedIn" /></a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Vybestack. Apache 2.0 License. Built for the terminal.</p>
    </div>
  </footer>

</body>
</html>