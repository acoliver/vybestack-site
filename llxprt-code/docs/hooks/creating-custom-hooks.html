<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating Custom Hooks | LLxprt Code Docs</title>
  <link rel="stylesheet" href="../../../vybestack.css" />
</head>
<body>

  <nav>
    <div class="nav-container">
      <div class="nav-left">
        <a href="/" class="logo">
          <img src="/assets/vybestack_logo.png" alt="Vybestack" />
        </a>
        <span class="tagline">Beyond Vibe Coding</span>
      </div>
      <div class="nav-right">
        <div class="nav-dropdown">
          <a href="/llxprt-code.html">LLxprt Code</a>
          <div class="nav-dropdown-menu">
            <a href="/llxprt-code.html">Overview</a>
            <a href="/llxprt-code/docs/">Documentation</a>
          </div>
        </div>
        <a href="/jefe.html">LLxprt Jefe</a>
        <a href="/blog/">Blog</a>
        <a href="/#podcast">Podcast</a>
        <a href="https://discord.gg/Wc6dZqWWYv" target="_blank">Discord</a>
      </div>
    </div>
  </nav>


  <section class="section docs-section">
    <div class="container-wide">
      <div class="docs-layout">

      <nav class="docs-sidebar">
        <h3><a href="/llxprt-code/docs/">Documentation</a></h3>
        <ul>
          <li><a href="/llxprt-code/docs/getting-started.html">Getting Started Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/providers.html">Provider Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/authentication.html">Authentication</a></li>
          <li><a href="/llxprt-code/docs/cli/profiles.html">Profiles</a></li>
          <li><a href="/llxprt-code/docs/sandbox.html">Sandboxing</a></li>
          <li><a href="/llxprt-code/docs/subagents.html">Subagents</a></li>
          <li><a href="/llxprt-code/docs/oauth-setup.html">OAuth Setup</a></li>
          <li><a href="/llxprt-code/docs/local-models.html">Local Models</a></li>
          <li><a href="/llxprt-code/docs/zed-integration.html">Zed Editor Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/providers-openai-responses.html">OpenAI Responses API</a></li>
          <li><a href="/llxprt-code/docs/prompt-configuration.html">Prompt Configuration</a></li>
          <li><a href="/llxprt-code/docs/settings-and-profiles.html">Settings and Profiles</a></li>
          <li><a href="/llxprt-code/docs/checkpointing.html">Checkpointing</a></li>
          <li><a href="/llxprt-code/docs/extension.html">Extensions</a></li>
          <li><a href="/llxprt-code/docs/ide-integration.html">IDE Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/configuration.html">Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/commands.html">Commands Reference</a></li>
          <li><a href="/llxprt-code/docs/troubleshooting.html">Troubleshooting Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/index.html">CLI Introduction</a></li>
          <li><a href="/llxprt-code/docs/deployment.html">Execution and Deployment</a></li>
          <li><a href="/llxprt-code/docs/keyboard-shortcuts.html">Keyboard Shortcuts</a></li>
          <li><a href="/llxprt-code/docs/cli/themes.html">Themes</a></li>
          <li><a href="/llxprt-code/docs/EMOJI-FILTER.html">Emoji Filter</a></li>
          <li><a href="/llxprt-code/docs/cli/runtime-helpers.html">Runtime helper APIs</a></li>
          <li><a href="/llxprt-code/docs/cli/context-dumping.html">Context Dumping</a></li>
          <li><a href="/llxprt-code/docs/telemetry.html">Telemetry</a></li>
          <li><a href="/llxprt-code/docs/telemetry-privacy.html">Telemetry Privacy</a></li>
          <li><a href="/llxprt-code/docs/gemini-cli-tips.html">Migration from Gemini CLI</a></li>
          <li><a href="/llxprt-code/docs/architecture.html">Architecture Overview</a></li>
          <li><a href="/llxprt-code/docs/core/index.html">Core Introduction</a></li>
          <li><a href="/llxprt-code/docs/core/provider-runtime-context.html">Provider runtime context</a></li>
          <li><a href="/llxprt-code/docs/core/provider-interface.html">Provider interface</a></li>
          <li><a href="/llxprt-code/docs/core/tools-api.html">Tools API</a></li>
          <li><a href="/llxprt-code/docs/core/memport.html">Memory Import Processor</a></li>
          <li><a href="/llxprt-code/docs/shell-replacement.html">Shell Replacement</a></li>
          <li><a href="/llxprt-code/docs/../CONTRIBUTING.html">Contributing & Development Guide</a></li>
          <li><a href="/llxprt-code/docs/npm.html">NPM Workspaces and Publishing</a></li>
          <li><a href="/llxprt-code/docs/migration/stateless-provider.html">Stateless provider migration</a></li>
          <li><a href="/llxprt-code/docs/tools/index.html">Tools Overview</a></li>
          <li><a href="/llxprt-code/docs/tools/file-system.html">File System Tools</a></li>
          <li><a href="/llxprt-code/docs/tools/multi-file.html">Multi-File Read Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/shell.html">Shell Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/mcp-server.html">MCP Server</a></li>
          <li><a href="/llxprt-code/docs/tools/web-fetch.html">Web Fetch Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/web-search.html">Web Search Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/memory.html">Memory Tool</a></li>
          <li><a href="/llxprt-code/docs/release-notes/stateless-provider.html">Release notes: Stateless Provider</a></li>
          <li><a href="/llxprt-code/docs/tos-privacy.html">Terms of Service and Privacy Notice</a></li>
        </ul>
      </nav>
        <div class="docs-content">
          <div class="blog-post-content">
            <h1>Creating Custom Hooks</h1>
<p>This tutorial walks you through creating custom hooks for LLxprt Code, from simple scripts to advanced use cases.</p>
<h2>Prerequisites</h2>
<ul>
<li>LLxprt Code installed and configured</li>
<li>Basic knowledge of bash or Python scripting</li>
<li>Understanding of JSON</li>
</ul>
<h2>Tutorial 1: Your First Hook - Security Policy</h2>
<p>Let's create a hook that blocks writes to sensitive directories.</p>
<h3>Step 1: Create the Hook Directory</h3>
<pre><code class="language-bash">mkdir -p ~/.llxprt/hooks
</code></pre>
<h3>Step 2: Write the Hook Script</h3>
<p>Create <code>~/.llxprt/hooks/block-sensitive-writes.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash
#
# BeforeTool hook: Block writes to sensitive directories
#
# Input: JSON with tool_name, tool_input, session_id, etc.
# Output: JSON with decision and optional reason
#

# Read all input from stdin
INPUT=$(cat)

# Parse the tool name
TOOL_NAME=$(echo &quot;$INPUT&quot; | jq -r '.tool_name // empty')

# Only check write operations
if [[ &quot;$TOOL_NAME&quot; != &quot;write_file&quot; &amp;&amp; &quot;$TOOL_NAME&quot; != &quot;edit&quot; ]]; then
  echo '{&quot;decision&quot;: &quot;allow&quot;}'
  exit 0
fi

# Get the target path
if [[ &quot;$TOOL_NAME&quot; == &quot;write_file&quot; ]]; then
  TARGET_PATH=$(echo &quot;$INPUT&quot; | jq -r '.tool_input.path // empty')
else
  TARGET_PATH=$(echo &quot;$INPUT&quot; | jq -r '.tool_input.file_path // empty')
fi

# Define sensitive directories
SENSITIVE_DIRS=(&quot;/etc&quot; &quot;/var&quot; &quot;/usr&quot; &quot;/System&quot; &quot;/Library&quot;)

# Check if path is in a sensitive directory
for DIR in &quot;${SENSITIVE_DIRS[@]}&quot;; do
  if [[ &quot;$TARGET_PATH&quot; == &quot;$DIR&quot;* ]]; then
    echo &quot;{\&quot;decision\&quot;: \&quot;deny\&quot;, \&quot;reason\&quot;: \&quot;Writing to $DIR is prohibited by security policy\&quot;}&quot;
    exit 2
  fi
done

# Allow all other writes
echo '{&quot;decision&quot;: &quot;allow&quot;}'
exit 0
</code></pre>
<p>Make it executable:</p>
<pre><code class="language-bash">chmod +x ~/.llxprt/hooks/block-sensitive-writes.sh
</code></pre>
<h3>Step 3: Configure the Hook</h3>
<p>Add to <code>~/.llxprt/settings.json</code>:</p>
<pre><code class="language-json">{
  &quot;hooks&quot;: {
    &quot;BeforeTool&quot;: [
      {
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/block-sensitive-writes.sh&quot;,
            &quot;timeout&quot;: 5000
          }
        ]
      }
    ]
  }
}
</code></pre>
<h3>Step 4: Test It</h3>
<p>Run LLxprt Code and try to write to a sensitive directory:</p>
<pre><code>You: Write &quot;test&quot; to /etc/test.txt

LLxprt: I cannot complete this request. The security policy blocks writes to /etc.
</code></pre>
<h2>Tutorial 2: Audit Logging Hook</h2>
<p>Create a hook that logs all tool executions.</p>
<h3>Create the Script</h3>
<p><code>~/.llxprt/hooks/audit-log.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash
#
# AfterTool hook: Log all tool executions
#

INPUT=$(cat)

# Extract relevant fields
TIMESTAMP=$(echo &quot;$INPUT&quot; | jq -r '.timestamp')
SESSION_ID=$(echo &quot;$INPUT&quot; | jq -r '.session_id')
TOOL_NAME=$(echo &quot;$INPUT&quot; | jq -r '.tool_name')
TOOL_INPUT=$(echo &quot;$INPUT&quot; | jq -c '.tool_input')
TOOL_RESPONSE=$(echo &quot;$INPUT&quot; | jq -c '.tool_response')

# Log to file
LOG_FILE=&quot;${HOME}/.llxprt/audit.log&quot;
echo &quot;{\&quot;timestamp\&quot;: \&quot;$TIMESTAMP\&quot;, \&quot;session\&quot;: \&quot;$SESSION_ID\&quot;, \&quot;tool\&quot;: \&quot;$TOOL_NAME\&quot;, \&quot;input\&quot;: $TOOL_INPUT, \&quot;response\&quot;: $TOOL_RESPONSE}&quot; &gt;&gt; &quot;$LOG_FILE&quot;

# Always allow - this is just logging
echo '{&quot;decision&quot;: &quot;allow&quot;}'
exit 0
</code></pre>
<h3>Configure It</h3>
<pre><code class="language-json">{
  &quot;hooks&quot;: {
    &quot;AfterTool&quot;: [
      {
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/audit-log.sh&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>
<h2>Tutorial 3: Tool Input Modification</h2>
<p>Create a hook that automatically adds safety flags to shell commands.</p>
<h3>Create the Script</h3>
<p><code>~/.llxprt/hooks/safe-shell.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash
#
# BeforeTool hook: Add safety flags to dangerous commands
#

INPUT=$(cat)
TOOL_NAME=$(echo &quot;$INPUT&quot; | jq -r '.tool_name')

# Only modify shell commands
if [[ &quot;$TOOL_NAME&quot; != &quot;run_shell_command&quot; ]]; then
  echo '{&quot;decision&quot;: &quot;allow&quot;}'
  exit 0
fi

COMMAND=$(echo &quot;$INPUT&quot; | jq -r '.tool_input.command')

# Add safety flags for rm commands
if [[ &quot;$COMMAND&quot; == rm\ * ]]; then
  # Add -i (interactive) flag if not present
  if [[ &quot;$COMMAND&quot; != *&quot;-i&quot;* &amp;&amp; &quot;$COMMAND&quot; != *&quot;--interactive&quot;* ]]; then
    SAFE_COMMAND=$(echo &quot;$COMMAND&quot; | sed 's/^rm /rm -i /')
    echo &quot;{\&quot;decision\&quot;: \&quot;allow\&quot;, \&quot;hookSpecificOutput\&quot;: {\&quot;tool_input\&quot;: {\&quot;command\&quot;: \&quot;$SAFE_COMMAND\&quot;}}}&quot;
    exit 0
  fi
fi

# Add --dry-run for rsync if not present
if [[ &quot;$COMMAND&quot; == rsync\ * &amp;&amp; &quot;$COMMAND&quot; != *&quot;--dry-run&quot;* ]]; then
  SAFE_COMMAND=$(echo &quot;$COMMAND&quot; | sed 's/^rsync /rsync --dry-run /')
  echo &quot;{\&quot;decision\&quot;: \&quot;allow\&quot;, \&quot;hookSpecificOutput\&quot;: {\&quot;tool_input\&quot;: {\&quot;command\&quot;: \&quot;$SAFE_COMMAND\&quot;}}}&quot;
  exit 0
fi

echo '{&quot;decision&quot;: &quot;allow&quot;}'
exit 0
</code></pre>
<h2>Tutorial 4: Python Hook - Rate Limiting</h2>
<p>Create a Python hook that implements rate limiting for API calls.</p>
<h3>Create the Script</h3>
<p><code>~/.llxprt/hooks/rate-limit.py</code>:</p>
<pre><code class="language-python">#!/usr/bin/env python3
&quot;&quot;&quot;
BeforeModel hook: Rate limit LLM calls
&quot;&quot;&quot;
import json
import sys
import os
import time
from pathlib import Path

# Rate limit config
MAX_CALLS_PER_MINUTE = 10
STATE_FILE = Path.home() / '.llxprt' / '.rate-limit-state.json'

def load_state():
    &quot;&quot;&quot;Load call history from state file.&quot;&quot;&quot;
    if STATE_FILE.exists():
        try:
            with open(STATE_FILE) as f:
                return json.load(f)
        except (json.JSONDecodeError, IOError):
            pass
    return {'calls': []}

def save_state(state):
    &quot;&quot;&quot;Save call history to state file.&quot;&quot;&quot;
    STATE_FILE.parent.mkdir(parents=True, exist_ok=True)
    with open(STATE_FILE, 'w') as f:
        json.dump(state, f)

def main():
    # Read input
    input_data = json.load(sys.stdin)

    # Load state
    state = load_state()
    now = time.time()

    # Remove calls older than 1 minute
    state['calls'] = [t for t in state['calls'] if now - t &lt; 60]

    # Check rate limit
    if len(state['calls']) &gt;= MAX_CALLS_PER_MINUTE:
        wait_time = int(60 - (now - state['calls'][0]))
        print(json.dumps({
            'continue': False,
            'reason': f'Rate limit exceeded. Please wait {wait_time} seconds.'
        }))
        sys.exit(2)

    # Record this call
    state['calls'].append(now)
    save_state(state)

    # Allow
    print(json.dumps({'continue': True}))
    sys.exit(0)

if __name__ == '__main__':
    main()
</code></pre>
<p>Make it executable:</p>
<pre><code class="language-bash">chmod +x ~/.llxprt/hooks/rate-limit.py
</code></pre>
<h3>Configure It</h3>
<pre><code class="language-json">{
  &quot;hooks&quot;: {
    &quot;BeforeModel&quot;: [
      {
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/rate-limit.py&quot;,
            &quot;timeout&quot;: 2000
          }
        ]
      }
    ]
  }
}
</code></pre>
<h2>Tutorial 5: Tool Selection Restriction</h2>
<p>Limit which tools are available based on context.</p>
<h3>Create the Script</h3>
<p><code>~/.llxprt/hooks/restrict-tools.sh</code>:</p>
<pre><code class="language-bash">#!/bin/bash
#
# BeforeToolSelection hook: Restrict tools based on directory
#

INPUT=$(cat)
CWD=$(echo &quot;$INPUT&quot; | jq -r '.cwd')

# In production directories, only allow read operations
if [[ &quot;$CWD&quot; == */production/* || &quot;$CWD&quot; == */prod/* ]]; then
  echo '{
    &quot;hookSpecificOutput&quot;: {
      &quot;toolConfig&quot;: {
        &quot;mode&quot;: &quot;AUTO&quot;,
        &quot;allowedFunctionNames&quot;: [&quot;read_file&quot;, &quot;read_many_files&quot;, &quot;glob&quot;, &quot;search_file_content&quot;, &quot;list_directory&quot;]
      }
    }
  }'
  exit 0
fi

# In test directories, allow everything
echo '{&quot;decision&quot;: &quot;allow&quot;}'
exit 0
</code></pre>
<h3>Configure It</h3>
<pre><code class="language-json">{
  &quot;hooks&quot;: {
    &quot;BeforeToolSelection&quot;: [
      {
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/restrict-tools.sh&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>
<h2>Tutorial 6: Multiple Hooks with Matchers</h2>
<p>Configure different hooks for different tools.</p>
<pre><code class="language-json">{
  &quot;hooks&quot;: {
    &quot;BeforeTool&quot;: [
      {
        &quot;matcher&quot;: &quot;write_*&quot;,
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/validate-writes.sh&quot;
          }
        ]
      },
      {
        &quot;matcher&quot;: &quot;run_shell_command&quot;,
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/validate-shell.sh&quot;
          }
        ]
      },
      {
        &quot;hooks&quot;: [
          {
            &quot;type&quot;: &quot;command&quot;,
            &quot;command&quot;: &quot;~/.llxprt/hooks/audit-all.sh&quot;
          }
        ]
      }
    ]
  }
}
</code></pre>
<p>In this configuration:</p>
<ul>
<li><code>validate-writes.sh</code> runs only for <code>write_file</code>, <code>write_many_files</code>, etc.</li>
<li><code>validate-shell.sh</code> runs only for shell commands</li>
<li><code>audit-all.sh</code> runs for ALL tools (no matcher)</li>
</ul>
<h2>Best Practices</h2>
<h3>1. Keep Hooks Fast</h3>
<p>Hooks run synchronously. Slow hooks delay the entire operation.</p>
<pre><code class="language-bash"># BAD: Slow network call
curl https://api.example.com/validate ...

# GOOD: Local check with timeout
timeout 1 ./quick-check.sh
</code></pre>
<h3>2. Exit Early</h3>
<p>Don't do unnecessary work:</p>
<pre><code class="language-bash"># Check if we care about this tool first
if [[ &quot;$TOOL_NAME&quot; != &quot;write_file&quot; ]]; then
  echo '{&quot;decision&quot;: &quot;allow&quot;}'
  exit 0  # Early exit
fi

# Now do the expensive check
</code></pre>
<h3>3. Handle Errors Gracefully</h3>
<pre><code class="language-bash"># Validate input
if ! echo &quot;$INPUT&quot; | jq empty 2&gt;/dev/null; then
  echo '{&quot;decision&quot;: &quot;allow&quot;}'  # Default to allow on parse error
  exit 0
fi
</code></pre>
<h3>4. Use Structured Logging</h3>
<pre><code class="language-python">import logging
import sys
import os

logging.basicConfig(
    filename=os.path.expanduser('~/.llxprt/hooks/debug.log'),
    level=logging.DEBUG
)

# Log to file, not stdout (stdout is for hook output)
logging.info(f&quot;Processing {input_data.get('tool_name')}&quot;)
</code></pre>
<h3>5. Test Your Hooks</h3>
<p>Create a test script:</p>
<pre><code class="language-bash">#!/bin/bash
# test-hook.sh

echo '{&quot;tool_name&quot;: &quot;write_file&quot;, &quot;tool_input&quot;: {&quot;path&quot;: &quot;/etc/test&quot;}}' | \
  ~/.llxprt/hooks/block-sensitive-writes.sh

echo &quot;Exit code: $?&quot;
</code></pre>
<h2>Common Patterns</h2>
<h3>Allow by Default, Deny Specific</h3>
<pre><code class="language-bash"># Deny list approach
case &quot;$TOOL_NAME&quot; in
  run_shell_command)
    # Extra scrutiny for shell
    if is_dangerous_command &quot;$COMMAND&quot;; then
      exit 2
    fi
    ;;
esac

echo '{&quot;decision&quot;: &quot;allow&quot;}'
exit 0
</code></pre>
<h3>Deny by Default, Allow Specific</h3>
<pre><code class="language-bash"># Allow list approach
case &quot;$TOOL_NAME&quot; in
  read_file|list_directory|glob)
    echo '{&quot;decision&quot;: &quot;allow&quot;}'
    exit 0
    ;;
esac

echo '{&quot;decision&quot;: &quot;deny&quot;, &quot;reason&quot;: &quot;Tool not in allowlist&quot;}'
exit 2
</code></pre>
<h3>Conditional Based on Session</h3>
<pre><code class="language-python">import os

# Check if running in CI
if os.environ.get('CI'):
    # More permissive in CI
    print('{&quot;decision&quot;: &quot;allow&quot;}')
else:
    # Stricter locally
    # ... validation logic
</code></pre>
<h2>Troubleshooting</h2>
<h3>Hook Not Running</h3>
<ol>
<li>Check the hook is executable: <code>ls -la ~/.llxprt/hooks/</code></li>
<li>Check settings.json syntax: <code>jq . ~/.llxprt/settings.json</code></li>
<li>Enable debug: <code>DEBUG=llxprt:core:hooks:* llxprt</code></li>
</ol>
<h3>Hook Output Not Parsed</h3>
<ol>
<li>Ensure output is valid JSON: <code>echo '{&quot;test&quot;: 1}' | jq .</code></li>
<li>Don't mix stdout logging with JSON output</li>
<li>Check for stderr output that might confuse parsing</li>
</ol>
<h3>Hook Times Out</h3>
<ol>
<li>Check timeout setting in config</li>
<li>Profile your hook to find slow parts</li>
<li>Consider async patterns for slow operations
operations</li>
</ol>

          </div>
        </div>
      </div>
    </div>
  </section>


  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>Vybestack</h4>
        <p>Beyond vibe coding. Autonomous development for ascending engineers.</p>
      </div>
      <div class="footer-section">
        <h4>Products</h4>
        <ul>
          <li><a href="/llxprt-code.html">LLxprt Code</a></li>
          <li><a href="/jefe.html">LLxprt Jefe</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Content</h4>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/#podcast">Podcast</a></li>
          <li><a href="/llxprt-code/docs/">Documentation</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Connect</h4>
        <ul class="social-links">
          <li><a href="https://github.com/vybestack/llxprt-code"><img src="/assets/github-mark-white.svg" alt="GitHub" /> </a></li>
          <li><a href="https://discord.gg/Wc6dZqWWYv"><img src="/assets/discord-mark-white.svg" alt="Discord" /></a></li>
          <li><a href="https://www.linkedin.com/company/vybestack/"><img src="/assets/linkedin-white.svg" alt="LinkedIn" /></a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Vybestack. Apache 2.0 License. Built for the terminal.</p>
    </div>
  </footer>

</body>
</html>