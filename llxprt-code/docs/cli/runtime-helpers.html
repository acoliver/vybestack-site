<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CLI Runtime Helper APIs | LLxprt Code Docs</title>
  <link rel="stylesheet" href="../../../vybestack.css" />
</head>
<body>

  <nav>
    <div class="nav-container">
      <div class="nav-left">
        <a href="/" class="logo">
          <img src="/assets/vybestack_logo.png" alt="Vybestack" />
        </a>
        <span class="tagline">Beyond Vibe Coding</span>
      </div>
      <div class="nav-right">
        <div class="nav-dropdown">
          <a href="/llxprt-code.html">LLxprt Code</a>
          <div class="nav-dropdown-menu">
            <a href="/llxprt-code.html">Overview</a>
            <a href="/llxprt-code/docs/">Documentation</a>
          </div>
        </div>
        <a href="/jefe.html">LLxprt Jefe</a>
        <a href="/blog/">Blog</a>
        <a href="/#podcast">Podcast</a>
        <a href="https://discord.gg/Wc6dZqWWYv" target="_blank">Discord</a>
      </div>
    </div>
  </nav>


  <section class="section docs-section">
    <div class="container-wide">
      <div class="docs-layout">

      <nav class="docs-sidebar">
        <h3><a href="/llxprt-code/docs/">Documentation</a></h3>
        <ul>
          <li><a href="/llxprt-code/docs/getting-started.html">Getting Started Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/providers.html">Provider Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/authentication.html">Authentication</a></li>
          <li><a href="/llxprt-code/docs/cli/profiles.html">Profiles</a></li>
          <li><a href="/llxprt-code/docs/subagents.html">Subagents</a></li>
          <li><a href="/llxprt-code/docs/oauth-setup.html">OAuth Setup</a></li>
          <li><a href="/llxprt-code/docs/local-models.html">Local Models</a></li>
          <li><a href="/llxprt-code/docs/zed-integration.html">Zed Editor Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/providers-openai-responses.html">OpenAI Responses API</a></li>
          <li><a href="/llxprt-code/docs/prompt-configuration.html">Prompt Configuration</a></li>
          <li><a href="/llxprt-code/docs/settings-and-profiles.html">Settings and Profiles</a></li>
          <li><a href="/llxprt-code/docs/checkpointing.html">Checkpointing</a></li>
          <li><a href="/llxprt-code/docs/extension.html">Extensions</a></li>
          <li><a href="/llxprt-code/docs/ide-integration.html">IDE Integration</a></li>
          <li><a href="/llxprt-code/docs/cli/configuration.html">Configuration</a></li>
          <li><a href="/llxprt-code/docs/cli/commands.html">Commands Reference</a></li>
          <li><a href="/llxprt-code/docs/troubleshooting.html">Troubleshooting Guide</a></li>
          <li><a href="/llxprt-code/docs/cli/index.html">CLI Introduction</a></li>
          <li><a href="/llxprt-code/docs/deployment.html">Execution and Deployment</a></li>
          <li><a href="/llxprt-code/docs/keyboard-shortcuts.html">Keyboard Shortcuts</a></li>
          <li><a href="/llxprt-code/docs/cli/themes.html">Themes</a></li>
          <li><a href="/llxprt-code/docs/EMOJI-FILTER.html">Emoji Filter</a></li>
          <li><a href="/llxprt-code/docs/cli/runtime-helpers.html">Runtime helper APIs</a></li>
          <li><a href="/llxprt-code/docs/cli/context-dumping.html">Context Dumping</a></li>
          <li><a href="/llxprt-code/docs/telemetry.html">Telemetry</a></li>
          <li><a href="/llxprt-code/docs/telemetry-privacy.html">Telemetry Privacy</a></li>
          <li><a href="/llxprt-code/docs/gemini-cli-tips.html">Migration from Gemini CLI</a></li>
          <li><a href="/llxprt-code/docs/architecture.html">Architecture Overview</a></li>
          <li><a href="/llxprt-code/docs/core/index.html">Core Introduction</a></li>
          <li><a href="/llxprt-code/docs/core/provider-runtime-context.html">Provider runtime context</a></li>
          <li><a href="/llxprt-code/docs/core/provider-interface.html">Provider interface</a></li>
          <li><a href="/llxprt-code/docs/core/tools-api.html">Tools API</a></li>
          <li><a href="/llxprt-code/docs/core/memport.html">Memory Import Processor</a></li>
          <li><a href="/llxprt-code/docs/sandbox.html">Sandbox Security</a></li>
          <li><a href="/llxprt-code/docs/shell-replacement.html">Shell Replacement</a></li>
          <li><a href="/llxprt-code/docs/../CONTRIBUTING.html">Contributing & Development Guide</a></li>
          <li><a href="/llxprt-code/docs/npm.html">NPM Workspaces and Publishing</a></li>
          <li><a href="/llxprt-code/docs/migration/stateless-provider.html">Stateless provider migration</a></li>
          <li><a href="/llxprt-code/docs/tools/index.html">Tools Overview</a></li>
          <li><a href="/llxprt-code/docs/tools/file-system.html">File System Tools</a></li>
          <li><a href="/llxprt-code/docs/tools/multi-file.html">Multi-File Read Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/shell.html">Shell Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/mcp-server.html">MCP Server</a></li>
          <li><a href="/llxprt-code/docs/tools/web-fetch.html">Web Fetch Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/web-search.html">Web Search Tool</a></li>
          <li><a href="/llxprt-code/docs/tools/memory.html">Memory Tool</a></li>
          <li><a href="/llxprt-code/docs/release-notes/stateless-provider.html">Release notes: Stateless Provider</a></li>
          <li><a href="/llxprt-code/docs/tos-privacy.html">Terms of Service and Privacy Notice</a></li>
        </ul>
      </nav>
        <div class="docs-content">
          <div class="blog-post-content">
            <h1>CLI Runtime Helper APIs</h1>
<!-- @plan:PLAN-20251018-STATELESSPROVIDER2.P20 @requirement:REQ-SP2-005 -->
<p>LLxprt Code exposes a runtime helper bundle in <code>packages/cli/src/runtime/runtimeSettings.ts</code>. The helpers give commands, React hooks, tests, and automation a stable way to manipulate provider configuration without importing global singletons.</p>
<h2>Accessing the active runtime</h2>
<pre><code class="language-ts">import {
  getCliRuntimeContext,
  getCliRuntimeServices,
  setCliRuntimeContext,
  resetCliProviderInfrastructure,
} from '../runtime/runtimeSettings.js';
</code></pre>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>setCliRuntimeContext(settingsService, config?, options?)</code></td>
<td>Registers the runtime context that backs CLI commands. Bootstrap calls this during startup and can refresh it when rehydrating settings.</td>
</tr>
<tr>
<td><code>getCliRuntimeContext()</code></td>
<td>Returns the active <code>ProviderRuntimeContext</code>. Throws if the runtime is not initialised.</td>
</tr>
<tr>
<td><code>getCliRuntimeServices()</code></td>
<td>Returns <code>{ settingsService, config, providerManager }</code> so UI hooks can interact with them safely.</td>
</tr>
<tr>
<td><code>resetCliProviderInfrastructure()</code></td>
<td>Clears cached managers â€“ useful in tests to ensure a fresh bootstrap.</td>
</tr>
</tbody>
</table>
<h2>Provider transitions</h2>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>switchActiveProvider(name)</code></td>
<td>Implements <code>/provider</code>. Updates the scoped <code>SettingsService</code>, reconfigures the <code>ProviderManager</code>, and refreshes auth when necessary.</td>
</tr>
<tr>
<td><code>getActiveProviderName()</code></td>
<td>Returns the provider selected for the current runtime.</td>
</tr>
<tr>
<td><code>listProviders()</code></td>
<td>Enumerates registered providers for UI pickers.</td>
</tr>
<tr>
<td><code>getActiveProviderStatus()</code></td>
<td>Supplies status components with provider, auth type, and model information.</td>
</tr>
</tbody>
</table>
<h2>Credentials &amp; endpoints</h2>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>updateActiveProviderApiKey(value)</code></td>
<td>Backs <code>/key</code> and <code>/keyfile</code>. Stores the secret on the runtime <code>SettingsService</code> and refreshes authentication.</td>
</tr>
<tr>
<td><code>updateActiveProviderBaseUrl(url)</code></td>
<td>Backs <code>/baseurl</code>. Persists overrides and clears them when called with <code>null</code> or <code>'none'</code>.</td>
</tr>
<tr>
<td><code>getActiveToolFormatState()</code></td>
<td>Reports the effective tool format and overrides for diagnostics.</td>
</tr>
<tr>
<td><code>getCliOAuthManager()</code></td>
<td>Returns the runtime-scoped OAuth manager used to mint or revoke tokens for the active provider.</td>
</tr>
</tbody>
</table>
<h2>Models and parameters</h2>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>setActiveModel(name)</code></td>
<td>Applies <code>/model</code> selections, updating <code>Config</code> and the runtime snapshot.</td>
</tr>
<tr>
<td><code>getActiveModelName()</code></td>
<td>Reads the current model resolved for the runtime.</td>
</tr>
<tr>
<td><code>setActiveModelParam(key, value)</code></td>
<td>Updates model parameters for the active provider.</td>
</tr>
<tr>
<td><code>clearActiveModelParam(key)</code></td>
<td>Removes a parameter override.</td>
</tr>
<tr>
<td><code>getActiveModelParams()</code></td>
<td>Returns the current parameter map for inspection or debugging.</td>
</tr>
</tbody>
</table>
<h2>Profiles and persistence</h2>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>buildRuntimeProfileSnapshot()</code></td>
<td>Captures the runtime state saved into profiles.</td>
</tr>
<tr>
<td><code>saveProfileSnapshot(name)</code></td>
<td>Persists the snapshot through <code>ProfileManager</code>.</td>
</tr>
<tr>
<td><code>loadProfileByName(name)</code></td>
<td>Applies stored profiles to the active runtime (used by <code>/profile load</code>).</td>
</tr>
<tr>
<td><code>deleteProfileByName(name)</code></td>
<td>Removes a stored profile and clears runtime references.</td>
</tr>
<tr>
<td><code>listSavedProfiles()</code></td>
<td>Enumerates available profiles.</td>
</tr>
<tr>
<td><code>getActiveProfileName()</code></td>
<td>Returns the profile currently associated with the runtime.</td>
</tr>
<tr>
<td><code>setDefaultProfileName(name)</code></td>
<td>Defines the profile that loads automatically on startup.</td>
</tr>
</tbody>
</table>
<h2>Diagnostics &amp; utilities</h2>
<table>
<thead>
<tr>
<th>Helper</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>getRuntimeDiagnosticsSnapshot()</code></td>
<td>Captures provider, model, and ephemeral settings for <code>/diagnostics</code>.</td>
</tr>
<tr>
<td><code>getCliProviderManager(options?)</code></td>
<td>Returns the provider manager, optionally wiring history callbacks for transcript logging.</td>
</tr>
</tbody>
</table>
<h2>Runtime scopes &amp; authentication</h2>
<ul>
<li><code>activateIsolatedRuntimeContext(handle, options)</code> uses <code>enterRuntimeScope</code> to push runtime metadata (runtime id, subagent descriptors) before activating helpers. Downstream credential requests inherit this scope, so the auth cache can separate CLI, automation, and nested job tokens.</li>
<li><code>registerCliProviderInfrastructure(manager, oauthManager)</code> wires <code>ProviderManager</code> and <code>OAuthManager</code> instances into the runtime registry. When a runtime shuts down, <code>resetCliProviderInfrastructure(runtimeId?)</code> clears both to force fresh connections on the next activation.</li>
<li>OAuth flows and device logins run through the runtime-specific <code>OAuthManager</code>, which tags requests with the runtime scope. When you call <code>/provider</code>, <code>/key</code>, or <code>/profile load</code>, the auth precedence resolver receives a flush notification for the current scope and removes cached tokens that no longer match.</li>
</ul>
<h2>Nested contexts</h2>
<p>Automation flows and <code>/subagent</code> runs can create isolated contexts while reusing the same helpers:</p>
<pre><code class="language-ts">import {
  createProviderRuntimeContext,
  setActiveProviderRuntimeContext,
  clearActiveProviderRuntimeContext,
} from '@vybestack/llxprt-code-core';
import {
  getCliRuntimeContext,
  switchActiveProvider,
} from '../runtime/runtimeSettings.js';

export async function runSubagentJob(metadata: Record&lt;string, unknown&gt;) {
  const parent = getCliRuntimeContext();
  const runtime = createProviderRuntimeContext({
    config: parent.config,
    metadata,
  });
  setActiveProviderRuntimeContext(runtime);
  try {
    if (metadata.provider) {
      await switchActiveProvider(String(metadata.provider));
    }
    // Execute task-specific logic here
  } finally {
    clearActiveProviderRuntimeContext();
    setActiveProviderRuntimeContext(parent);
  }
}
</code></pre>
<p>The helpers always operate on the active context, ensuring nested runs can adjust provider credentials or model parameters without disturbing the caller.</p>

          </div>
        </div>
      </div>
    </div>
  </section>


  <footer class="footer">
    <div class="footer-container">
      <div class="footer-section">
        <h4>Vybestack</h4>
        <p>Beyond vibe coding. Autonomous development for ascending engineers.</p>
      </div>
      <div class="footer-section">
        <h4>Products</h4>
        <ul>
          <li><a href="/llxprt-code.html">LLxprt Code</a></li>
          <li><a href="/jefe.html">LLxprt Jefe</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Content</h4>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/#podcast">Podcast</a></li>
          <li><a href="/llxprt-code/docs/">Documentation</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Connect</h4>
        <ul class="footer-icons">
<li><a href="https://github.com/vybestack/llxprt-code"><img src="/assets/icons/github.svg" alt="GitHub" /> </a></li>
<li><a href="https://discord.gg/Wc6dZqWWYv"><img src="/assets/icons/discord.svg" alt="Discord" /></a></li>
<li><a href="https://www.linkedin.com/company/vybestack/"><img src="/assets/icons/linkedin.svg" alt="LinkedIn" /></a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2026 Vybestack. Apache 2.0 License. Built for the terminal.</p>
    </div>
  </footer>

</body>
</html>